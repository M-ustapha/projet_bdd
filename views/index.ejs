<!DOCTYPE html>
<html lang="en">

<head>
    <!-- basic -->
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <!-- mobile metas -->
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="viewport" content="initial-scale=1, maximum-scale=1">
    <!-- site metas -->
    <title>jackpiro</title>
    <meta name="keywords" content="">
    <meta name="description" content="">
    <meta name="author" content="">
    <!-- bootstrap css -->
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <!-- style css -->
    <link rel="stylesheet" href="css/style.css">
    <!-- Responsive-->
    <link rel="stylesheet" href="css/responsive.css">
    <!-- fevicon -->
    <link rel="icon" href="images/fevicon.png" type="image/gif" />
    <!-- Scrollbar Custom CSS -->
    <link rel="stylesheet" href="css/jquery.mCustomScrollbar.min.css">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.css" media="screen">
</head>

<body class="main-layout">
    <!-- Loader, Header, Slider, etc. as provided -->

    <!-- Our Movies Section -->
    <div id="games" class="our">
        <div class="container">
            <div class="row">
                <div class="col-md-12">
                    <div class="titlepage">
                        <h2>Our Movies</h2>
                    </div>
                </div>
            </div>
            <div class="row">
                <style>
                    .movie-container {
                        border: 1px solid #ddd;
                        padding: 15px;
                        margin-bottom: 20px;
                        border-radius: 10px;
                    }
                    .movie-container img {
                        width: 100%;
                        height: auto;
                        max-height: 400px;
                        object-fit: cover;
                    }
                </style>

                <div class="container">
                    <% if (movies.length > 0) { %>
                        <% movies.forEach(movie => { %>
                            <div class="col-md-12 margin_bottom movie-container">
                                <div class="row">
                                    <div class="col-xl-4 col-lg-4 col-md-4 col-sm-12">
                                        <div class="two-box">
                                            <% if (movie.poster) { %>
                                                <figure><img src="<%= movie.poster %>" alt="Affiche de <%= movie.title %>"></figure>
                                            <% } %>
                                        </div>
                                    </div>
                        
                                    <div class="col-xl-8 col-lg-8 col-md-8 col-sm-12">
                                        <div class="Games">
                                            <h3><%= movie.title %></h3>
                                            <p><strong>Année :</strong> <%= movie.releaseYear %></p>
                                            <p><strong>Durée :</strong> <%= movie.duration %> minutes</p>
                                            <p><strong>Genre :</strong> <%= movie.genre %></p>
                                            <p><strong>Réalisateur :</strong> <%= movie.director %></p>
                                            <p><strong>Synopsis :</strong> <%= movie.synopsis %></p>
                        
                                            <!-- Affiche la note moyenne si elle existe -->
                                            <% if (movie.averageRating) { %>
                                                <p><strong>Note Moyenne :</strong> <%= movie.averageRating.toFixed(1) %> / 5</p>
                                            <% } else { %>
                                                <p><strong>Note Moyenne :</strong> Pas encore de notes</p>
                                            <% } %>
                        
                                            <a href="/movies/edit/<%= movie._id %>">Modifier</a>
                                            <form action="/movies/delete/<%= movie._id %>" method="POST" style="display:inline;">
                                                <button type="submit">Supprimer</button>
                                            </form>
                                            <a href="/seances/movie/<%= movie._id %>">Consulter les séances</a>
                                        </div>
                        
                                        <!-- Section des Avis -->
<h4>Reviews</h4>
<% if (movie.reviews && movie.reviews.length > 0) { %>
    <% movie.reviews.forEach(review => { %>
        <div>
            <p><strong><%= review.userName || 'Anonymous' %></strong></p>
            <% if (review.rating) { %>
                <p>Note : <%= review.rating %> / 5</p>
            <% } %>
            <% if (review.comment) { %>
                <p>Commentaire : <%= review.comment %></p>
            <% } %>
        </div>
    <% }) %>
<% } else { %>
    <p>Aucun avis disponible pour ce film.</p>
<% } %>
                        
                                        <!-- Formulaire pour ajouter un avis -->
                                        <h4>Ajouter un Avis</h4>
                                        <form action="/movies/<%= movie._id %>/review" method="POST">
                                            <div class="form-group">
                                                <label for="userName">Nom :</label>
                                                <input type="text" id="userName" name="userName" placeholder="Votre nom" class="form-control">
                                            </div>
                                            <div class="form-group">
                                                <label for="rating">Note (1-5) :</label>
                                                <input type="number" id="rating" name="rating" min="1" max="5" class="form-control">
                                            </div>
                                            <div class="form-group">
                                                <label for="comment">Commentaire :</label>
                                                <textarea id="comment" name="comment" placeholder="Votre commentaire" class="form-control"></textarea>
                                            </div>
                                            <button type="submit" class="btn btn-primary">Soumettre l'avis</button>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        <% }) %>
                        
                    <% } else { %>
                        <p>Aucun film disponible.</p>
                    <% } %>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer and other sections as provided -->

    <!-- Javascript files -->
    <script src="js/jquery.min.js"></script>
    <script src="js/popper.min.js"></script>
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/jquery-3.0.0.min.js"></script>
    <script src="js/plugin.js"></script>
    <script src="js/jquery.mCustomScrollbar.concat.min.js"></script>
    <script src="js/custom.js"></script>
    <script src="https:cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.5/jquery.fancybox.min.js"></script>
</body>

</html>
